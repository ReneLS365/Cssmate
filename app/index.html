<!doctype html>
<html lang=da>
<head>
  
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name=description content="CSMate ‚Äì stilladsopt√¶lling, akkord og PWA til byggepladsen.">
  <meta name=theme-color content=#0f172a>
  <meta name=apple-mobile-web-app-capable content=yes>
  <meta name=apple-mobile-web-app-status-bar-style content=black-translucent>
  <title>akkordseddel</title>
  <link rel=stylesheet href=style.css>
  <link rel=stylesheet href=css/numpad.css>
  <link rel=stylesheet href=print.css media=print>
  <link rel=stylesheet href=src/styles/fixes.css>
  <link rel=stylesheet href=/css/pwa.css>
  <link rel=manifest href=/manifest.webmanifest crossorigin=anonymous>
  <link rel=apple-touch-icon href=/icons/icon-192.png>
  <link rel=canonical href=https://csmate.netlify.app/ >
</head>
<body>
  <a class=skip-to-content href=#main>Spring til indhold</a>
  <div id=iosInstallPrompt class=ios-install-prompt role=region aria-live=polite hidden>
    <p>Tilf√∏j CSMate til hjemmesk√¶rmen: Tryk p√• delingsknappen og v√¶lg <strong>F√∏j til hjemmesk√¶rm</strong>.</p>
    <button type=button id=iosInstallDismiss class=ios-install-dismiss aria-label="Skjul iOS installationshint">‚úï</button>
  </div>
  <div id=app class=app-shell>
    <header data-allow-click>
      <div class=bar>
        <h1 class=ttl>akkordseddel</h1>
        <nav>
          <button id=btnSagsinfo data-section=sagsinfo class=active type=button>Sagsinfo</button>
          <button id=btnOptaelling data-section=optaelling type=button>Opt√¶lling</button>
          <button id=btnLon data-section=lon type=button>L√∏n</button>
        </nav>
      </div>
    </header>
    <div class=app-content>
      <div class=materials-scroll>
        <main id=main>
  <section id=sagsinfoSection class=sektion>
    <fieldset>
      <legend>Stamdata</legend>
      <div class=status-bar>
        <label for=sagStatus class=status-select>
          <span>Status</span>
          <select id=sagStatus name=sagStatus>
            <option value=kladde>Kladde</option>
            <option value=afventer>Afventer</option>
            <option value=godkendt>Godkendt</option>
            <option value=afvist>Afvist</option>
          </select>
        </label>
        <div class=status-indicator>
          <span>Aktuel status</span>
          <strong id=statusIndicator data-status=kladde class=status-pill>Kladde</strong>
        </div>
      </div>
      <div class="form-grid grid-3">
        <label for=sagsnummer>
          <span>Sagsnummer</span>
          <input id=sagsnummer name=sagsnummer required>
        </label>
        <label for=sagsnavn>
          <span>Navn/opgave</span>
          <input id=sagsnavn name=navn required>
        </label>
        <label for=sagsadresse>
          <span>Adresse</span>
          <input id=sagsadresse name=adresse required>
        </label>
        <label for=sagskunde>
          <span>Kunde</span>
          <input id=sagskunde name=kunde required>
        </label>
        <label for=sagsdato class=date-field>
          <span>Dato</span>
          <div class=date-input-wrapper>
            <input id=sagsdato name=dato type=date required inputmode=numeric>
            <button id=calendarIcon class=date-picker-trigger type=button aria-label="√Öbn kalender">üìÖ</button>
          </div>
        </label>
        <label for=sagsmontoer class=col-span-3>
          <span>Mont√∏rnavne</span>
          <textarea id=sagsmontoer name=montoer rows=3 placeholder="Fx: Anna Jensen, Bo Nielsen" required></textarea>
        </label>
      </div>
      <div class="form-actions no-print">
        <button id=btnOpenGuideModal type=button>√Öbn guide</button>
      </div>
    </fieldset>
  </section>

  <section id=optaellingSection class=sektion hidden>
    <fieldset>
      <legend>Systemer</legend>
      <div id=listSelectors class=row></div>
    </fieldset>

    <fieldset>
      <legend>Materialer</legend>
      <div class="material-options no-print">
        <label class=toggle-selected>
          <input type=checkbox id=showSelectedOnly>
          <span>Vis kun valgte materialer</span>
        </label>
      </div>

      <div id=optaellingContainer class=materials></div>
    </fieldset>

    <section id=overview class=overview>
      <div class=totals>
        <div>
          <span>Materialesum</span>
          <strong data-total=material>0,00</strong>
        </div>
        <div>
          <span>L√∏nsum</span>
          <strong data-total=labor>0,00</strong>
        </div>
        <div>
          <span>Projektsum</span>
          <strong data-total=project>0,00</strong>
        </div>
      </div>
    </section>

    <p id=actionHint class="hint no-print">Udfyld Sagsinfo for at forts√¶tte.</p>

    <fieldset class=no-print data-allow-click>
      <legend>Admin</legend>
      <div class=row>
        <label class=sr-only for=adminCode>Admin kode</label>
        <input id=adminCode placeholder=Kode>
        <button id=btnAdminLogin type=button>Log ind</button>
      </div>
      <p id=adminFeedback class=status-message hidden aria-live=polite></p>
      <button id=btnHardResetApp type=button hidden>Nulstil app-data</button>
    </fieldset>
  </section>

  <section id=lonSection class=sektion hidden>
    <fieldset>
      <legend>Type & bel√∏b</legend>
      <div class=grid-3>
        <label for=jobType><span>Arbejdstype</span>
          <select id=jobType>
            <option value=montage>Montage</option>
            <option value=demontage>Demontage (50%)</option>
          </select>
        </label>
        <label for=montagepris><span>Montagepris (auto)</span>
          <input id=montagepris placeholder="Montagepris (auto)" inputmode=decimal data-numpad=true data-decimal=comma data-numpad-field=montagepris>
        </label>
        <label for=demontagepris><span>Demontagepris (auto)</span>
          <input id=demontagepris placeholder="Demontagepris (auto)" inputmode=decimal data-numpad=true data-decimal=comma data-numpad-field=demontagepris>
        </label>
      </div>
    </fieldset>
    <fieldset>
      <legend>Till√¶g & km</legend>
      <div class=grid-2>
        <label for=slaebePct><span>Sl√¶b i %</span>
          <input id=slaebePct placeholder="Sl√¶b i %" inputmode=decimal data-numpad=true data-decimal=comma data-numpad-field=slaebePct>
        </label>
        <label for=km><span>Km</span>
          <input id=km placeholder=Km inputmode=decimal data-numpad=true data-decimal=comma data-numpad-field=km>
        </label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Ekstra arbejde</legend>
      <div class="grid-3 extra-work-grid">
        <label for=antalBoringHuller><span>Huller (antal)</span>
          <input id=antalBoringHuller placeholder="Huller (antal)" inputmode=numeric data-numpad=true data-decimal=comma data-testid=antal-input-1 data-numpad-field=antalBoringHuller>
        </label>
        <label for=antalLukHuller><span>Luk af hul (antal)</span>
          <input id=antalLukHuller placeholder="Luk af hul (antal)" inputmode=numeric data-numpad=true data-decimal=comma data-numpad-field=antalLukHuller>
        </label>
        <label for=antalBoringBeton><span>Boring i beton (antal)</span>
          <input id=antalBoringBeton placeholder="Boring i beton (antal)" inputmode=numeric data-numpad=true data-decimal=comma data-numpad-field=antalBoringBeton>
        </label>
        <label for=antalOpskydeligt><span>Opskydeligt r√¶kv√¶rk (antal)</span>
          <input id=antalOpskydeligt placeholder="Opskydeligt r√¶kv√¶rk (antal)" inputmode=numeric data-numpad=true data-decimal=comma data-numpad-field=antalOpskydeligt>
        </label>
        <label for=traelleloeft35><span>Trallel√∏ft 0,35 (antal)</span>
          <input id=traelleloeft35 placeholder="Trallel√∏ft 0,35 (antal)" inputmode=numeric data-numpad=true data-decimal=comma data-numpad-field=traelleloeft35>
        </label>
        <label for=traelleloeft50><span>Trallel√∏ft 0,50 (antal)</span>
          <input id=traelleloeft50 placeholder="Trallel√∏ft 0,50 (antal)" inputmode=numeric data-numpad=true data-decimal=comma data-numpad-field=traelleloeft50>
        </label>
      </div>
    </fieldset>

    <section class="overview overview-inline">
      <div class=totals>
        <div>
          <span>Materialesum</span>
          <strong data-total=material>0,00</strong>
        </div>
        <div>
          <span>L√∏nsum</span>
          <strong data-total=labor>0,00</strong>
        </div>
        <div>
          <span>Projektsum</span>
          <strong data-total=project>0,00</strong>
        </div>
      </div>
    </section>

    <div class="row no-print btn-group">
      <button id=btnBeregnLon type=button>Beregn l√∏n</button>
      <button id=btnPrint type=button disabled>Print</button>
    </div>
    <fieldset>
      <legend>Resultat</legend>
      <div id=lonResult></div>
    </fieldset>

    <fieldset class=no-print>
      <legend>Medarbejdere</legend>
      <div id=workers></div>
      <div class=row>
        <button id=btnAddWorker type=button>+ Tilf√∏j mand</button>
      </div>
    </fieldset>
  </section>
        </main>
      </div>
    </div>

    <div id=guideModal class=modal hidden aria-hidden=true>
      <div class=modal-content role=dialog aria-modal=true aria-labelledby=guideModalTitle tabindex=-1>
        <button type=button class=modal-close aria-label=Luk>√ó</button>
        <h2 id=guideModalTitle>Guide til CSMate</h2>
        <p>
          F√∏lg disse trin for at genskabe den stabile arbejdsgang:
        </p>
        <ol>
          <li>Udfyld <strong>Sagsinfo</strong> med de grundl√¶ggende oplysninger.</li>
          <li>V√¶lg system i <strong>Opt√¶lling</strong> og indtast materialer.</li>
          <li>Udskriv eller eksport√©r akkordsedlen fra <strong>L√∏n</strong> fanen.</li>
          <li>Tilf√∏j medarbejdere under <strong>L√∏n</strong> og beregn akkord.</li>
        </ol>
        <p>
          Har du brug for yderligere hj√¶lp, kan du kontakte administratoren eller sl√• op i virksomhedens
          interne vejledninger.
        </p>
      </div>
    </div>
  </div>

  <div id="numpad-overlay" class="numpad-hidden" aria-hidden="true">
    <div class="numpad-panel" role="dialog" aria-label="Numpad lommeregner">
      <button type="button" class="numpad-close" id="numpad-btn-close">‚úï</button>

      <div class="numpad-display">
        <div class="numpad-display-memory" id="numpad-display-memory">M: 0</div>
        <div class="numpad-display-expression" id="numpad-display-expression"></div>
        <div class="numpad-display-current" id="numpad-display-current">0</div>
      </div>

      <div class="numpad-grid">
        <button data-key="C" class="numpad-key numpad-key-func">C</button>
        <button data-key="√∑" class="numpad-key numpad-key-op">√∑</button>
        <button data-key="√ó" class="numpad-key numpad-key-op">√ó</button>
        <button data-key="BACK" class="numpad-key numpad-key-func">‚å´</button>

        <button data-key="7" class="numpad-key">7</button>
        <button data-key="8" class="numpad-key">8</button>
        <button data-key="9" class="numpad-key">9</button>
        <button data-key="-" class="numpad-key numpad-key-op">-</button>

        <button data-key="4" class="numpad-key">4</button>
        <button data-key="5" class="numpad-key">5</button>
        <button data-key="6" class="numpad-key">6</button>
        <button data-key="+" class="numpad-key numpad-key-op">+</button>

        <button data-key="1" class="numpad-key">1</button>
        <button data-key="2" class="numpad-key">2</button>
        <button data-key="3" class="numpad-key">3</button>
        <button data-key="=" class="numpad-key numpad-key-eq">=</button>

        <button data-key="%" class="numpad-key numpad-key-func">%</button>
        <button data-key="0" class="numpad-key">0</button>
        <button data-key="," class="numpad-key">,</button>
        <div class="numpad-key numpad-key-empty"></div>
      </div>

      <button type="button" class="numpad-commit" id="numpad-btn-commit">‚úì</button>
    </div>
  </div>

<script type=module src=main.js></script>
<script>(()=>{let a=document.getElementById("optaellingContainer");if(a){let c=new Intl.NumberFormat("da-DK",{style:"currency",currency:"DKK"});function o(e){if(null==e)return 0;let t=String(e).trim();var e=(t=t.replace(/\s+/g,"")).lastIndexOf(","),a=t.lastIndexOf("."),a=(t=(t=-1<e&&-1<a?a<e?t.replace(/\./g,"").replace(",","."):t.replace(/,/g,""):t.replace(",",".")).replace(/[^0-9.]/g,"")).indexOf(".");return""===(t=-1!==a?t.slice(0,a+1)+t.slice(a+1).replace(/\./g,""):t)||"."===t||(e=parseFloat(t),!Number.isFinite(e))||e<0?0:e}function s(e){return e.toFixed(6).replace(/0+$/,"").replace(/\.$/,"").replace(".",",")}function p(e){return Math.round(100*e)/100}function r(t){if(t){var a=t.querySelector(".mat-qty"),r=t.querySelector(".mat-price"),l=t.querySelector(".mat-line");if(a&&r&&l){var i=o(a.value);let e=parseFloat(r.dataset.price||"");Number.isFinite(e)||(e=o(r.value));var n=p(i*(Number.isFinite(e)?e:0)),u=s(i),a=(a.value="number"===a.type?u.replace(",","."):u,0<i),t=(t.toggleAttribute("data-has-qty",a),t.dataset.hasQty=a?"true":"false",Number.isFinite(e)?(u=e.toFixed(2),r.value="number"===r.type?u:u.replace(".",",")):r.value?"number"===r.type?(i=o(r.value),r.value=Number.isFinite(i)?String(i):""):r.value=String(r.value).replace(".",","):r.value="",c.format(n)),a=t+" kr";l instanceof HTMLInputElement?l.value=a:l.textContent=a}}}a.querySelectorAll(".mat-row").forEach(r),a.addEventListener("input",e=>{e.target.classList.contains("mat-qty")&&(r(e.target.closest(".mat-row")),"function"==typeof recalcTotals?recalcTotals():"function"==typeof updateTotals&&updateTotals())}),new MutationObserver(e=>{let t=!1;e.forEach(e=>{"childList"===e.type?e.addedNodes.forEach(e=>{e instanceof Element&&(e.classList.contains("mat-row")||e.querySelector(".mat-row"))&&(t=!0)}):"attributes"===e.type&&"data-price"===e.attributeName&&(t=!0)}),t&&a.querySelectorAll(".mat-row").forEach(r)}).observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-price"]}),window.parseQty=o,window.formatQtyDK=s,window.round2=p,window.updateMaterialLine=e=>r(e)}})()</script>

  <div class=pwa-install-wrap role=presentation>
    <button id=installBtn class=pwa-install-btn type=button hidden>Installer app</button>
  </div>

<script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).catch(async e=>{var r=!1===navigator.onLine,o=new Set(["AbortError","NetworkError"]),i="string"==typeof e?.message?e.message:"";if(r||"object"==typeof e&&null!==e&&o.has(e.name)||/(?:offline|network)/i.test(i))console.warn("Service worker registration failed due to network issues; keeping existing worker",e);else try{var t=await navigator.serviceWorker.getRegistrations();await Promise.all(t.map(e=>e.unregister()))}finally{r=new URL(window.location.href);r.searchParams.set("no-sw",Date.now().toString()),window.location.replace(r.toString())}})})</script>


