:root{
  /* Core palette */
  --bg:#15171b;
  --surface:#1e1f24;
  --surface-2:#24262c;
  --text:#f5f6f8;
  --muted:#c6c8cf;
  --text-strong:var(--text);
  --border:#363842;
  --accent:#9cb4cf;
  --accent-strong:#f2b661;
  --accent-soft:color-mix(in srgb, var(--accent) 18%, transparent);
  --text-on-accent:#0f1625;
  --text-on-accent-strong:#0f1625;
  --card:var(--surface);
  --danger:#ff6b6b;
  --success:#7bd99a;

  /* Legacy aliases (in use across the app) */
  --bg-legacy:var(--bg);
  --elev:var(--surface);
  --panel:var(--surface-2);
  --panel-soft:color-mix(in srgb, var(--surface-2) 92%, #000 8%);
  --panel-muted:color-mix(in srgb, var(--surface) 82%, #000 18%);

  /* Radii */
  --r-sm:10px;
  --r-md:12px;
  --r-lg:14px;
  --radius-md:var(--r-sm);
  --radius-lg:16px;

  /* Spacing + typography */
  --sp-1:6px;
  --sp-2:8px;
  --sp-3:12px;
  --sp-4:16px;
  --sp-5:20px;
  --fs-1:12px;
  --fs-2:14px;
  --fs-3:16px;
  --fs-4:18px;
  --gap:var(--sp-3);
  --pad:var(--sp-3);

  --shadow-1:0 14px 38px rgba(0,0,0,0.38);
  --shadow-strong:var(--shadow-1);
  --uiScale:1;
  --materials-grid-desktop:2fr minmax(64px,0.9fr) minmax(72px,1fr) minmax(72px,1fr);
  --materials-grid-mobile:1.4fr minmax(56px,0.8fr) minmax(64px,0.9fr) minmax(64px,0.9fr);
  --header-height:56px;
  --tab-bar-height:52px;
}

[data-theme="light"]{
  --bg:#f3f5f8;
  --surface:#ffffff;
  --surface-2:#f6f7fb;
  --text:#0f1625;
  --muted:#5c6677;
  --text-strong:#0f1625;
  --border:#d8dce4;
  --accent:#3f7ac8;
  --accent-strong:#f2b661;
  --accent-soft:color-mix(in srgb, var(--accent) 22%, transparent);
  --text-on-accent:#f5f6f8;
  --text-on-accent-strong:#0f1625;
  --card:var(--surface);
  --panel-soft:color-mix(in srgb, var(--surface-2) 80%, #000 20%);
  --panel-muted:color-mix(in srgb, var(--surface) 84%, #000 16%);
}
:focus-visible{outline:2px solid currentColor;outline-offset:2px}
.skip-to-content{position:absolute;left:-9999px;top:0;background:var(--panel);color:var(--text);padding:8px 14px;border-radius:var(--r-md);z-index:1000;box-shadow:var(--shadow-1)}
.skip-to-content:focus{left:1rem;top:1rem}
.ios-install-prompt{position:fixed;bottom:1.25rem;left:50%;transform:translateX(-50%);background:var(--panel);color:var(--text);padding:14px 16px;border-radius:14px;border:1px solid var(--border);box-shadow:0 18px 40px rgba(0,0,0,0.45);display:flex;gap:12px;align-items:center;max-width:min(420px,90vw);line-height:1.4;z-index:900}
.ios-install-prompt p{margin:0}
.ios-install-prompt strong{color:var(--accent)}
.ios-install-prompt[hidden]{display:none}
.ios-install-dismiss{border:1px solid var(--border);background:transparent;color:var(--text);width:32px;height:32px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:1rem;padding:0;cursor:pointer}
.ios-install-dismiss:hover{background:rgba(255,255,255,0.08)}
.ios-install-dismiss:focus-visible{outline:2px solid var(--accent)}
@media (prefers-reduced-motion: reduce){
  *,*::before,*::after{animation-duration:0.001ms!important;animation-iteration-count:1!important;transition-duration:0.001ms!important;scroll-behavior:auto!important}
  .ios-install-prompt{transition:none}
}
*{box-sizing:border-box}
html,body{margin:0;min-height:100%;width:100%;max-width:100vw;overflow-x:hidden;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
html{
  -ms-touch-action:manipulation;
  touch-action:manipulation;
}
html,body,.app-shell,.app-content,.materials-scroll{min-height:100%}
body{font-size:16px;line-height:1.45;font-weight:400;background-color:var(--bg,#121212);overscroll-behavior-y:contain}
.app-shell,.app-content,.materials-scroll{max-width:100vw}
@media (max-width:420px){
  .app-shell,.app-content,main,header,footer{width:100%;max-width:100vw}
}

@media (max-width:360px){
  .app-root{padding:0 var(--sp-2) calc(1.25rem + env(safe-area-inset-bottom,0))}
  .tab{padding:0.45rem 0.7rem;font-size:0.9rem}
}
.app-shell{display:flex;flex-direction:column}
.app-content{flex:1 1 auto;min-height:0;display:flex;flex-direction:column}
.app-shell{transform:scale(var(--uiScale));transform-origin:top left;width:calc(100%/var(--uiScale))}
.materials-scroll{flex:1 1 auto;min-height:0;display:flex;flex-direction:column;overscroll-behavior:contain;padding-bottom:0!important}
.materials-scroll>:last-child{margin-bottom:0!important}
:root.np-open,
:root.np-open body{
  overflow:hidden!important;
  overscroll-behavior:contain;
}
@supports not (height: 100dvh){
  .app-shell{height:var(--app-vh,100vh)}
}
header{position:sticky;top:0;background:var(--elev);border-bottom:1px solid var(--border);z-index:5}
header .bar{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:6px 10px;min-height:var(--header-height)}
header .ttl{font-weight:700}
.topbar-nav{display:flex;align-items:center;gap:8px;flex:1 1 auto;min-width:0}
.topbar-actions{display:flex;align-items:center;flex:0 0 auto}
.ui-scale-control{position:relative;display:flex;align-items:center;gap:6px}
.ui-scale-toggle{min-width:36px;min-height:36px;padding:6px 8px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:10px;font-size:1rem}
.ui-scale-popover{position:absolute;right:0;top:calc(100% + 6px);background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px;min-width:180px;box-shadow:0 10px 28px rgba(0,0,0,0.35);z-index:20}
.ui-scale-row{display:flex;align-items:center;gap:8px;justify-content:space-between;margin-bottom:6px}
.ui-scale-row:last-child{margin-bottom:0}
.ui-scale-presets{flex-wrap:wrap}
.ui-scale-chip{flex:1 1 auto;min-width:64px;padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:var(--panel-soft);color:var(--text);font-weight:600;text-align:center}
.ui-scale-chip:focus-visible,.ui-scale-reset:focus-visible{outline:2px solid var(--accent)}
.ui-scale-value{font-weight:700;flex:1 1 auto;text-align:center}
.ui-scale-reset{width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:var(--panel-soft);color:var(--text);font-weight:600}
.ui-scale-popover[hidden]{display:none}
.tabs{display:flex;gap:0.35rem;overflow-x:auto;padding:0.25rem 0;border-radius:0.75rem;-webkit-overflow-scrolling:touch;scrollbar-width:thin;scrollbar-color:var(--accent) transparent;touch-action:pan-x;scrollbar-gutter:stable both-edges;overscroll-behavior-x:contain;flex:1 1 auto;min-width:0;max-width:100%}
.materials-list,
.table-wrapper,
.scroll-area{overscroll-behavior:auto}
.tabs::-webkit-scrollbar{height:4px}
.tab{flex:0 0 auto;scroll-snap-align:start;min-width:4.5rem;padding:0.5rem 0.85rem;font-size:0.95rem;border-radius:0.6rem;border:1px solid rgba(255,255,255,0.08);background:var(--panel);color:var(--muted);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:background-color .15s ease,color .15s ease,border-color .15s ease,transform .12s ease}
.tab:not(.tab--active):hover{color:var(--text);border-color:rgba(255,255,255,0.18)}
.tab--active{background:var(--accent);color:var(--text-on-accent);border-color:var(--accent);box-shadow:0 0 0 1px rgba(0,0,0,0.08) inset}
.tab-panel{display:none;width:100%;min-height:0}
.tab-panel.tab-panel--active{display:flex;flex-direction:column;gap:var(--gap);min-height:0}
#panel-lon{flex-direction:column;flex:1 1 auto;min-height:0;overflow-y:auto;padding-bottom:calc(env(safe-area-inset-bottom,0) + 4rem);scroll-padding-bottom:calc(env(safe-area-inset-bottom,0) + 4rem)}
button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.material-row input:focus-visible,.csm-row input:focus-visible{outline:2px solid var(--accent)}
button,
.tab,
[data-clickable],
input[type=button],
input[type=submit],
.icon-button,
.material-btn{
  min-height:44px;
  min-width:44px;
  padding:0.5rem 0.75rem;
  touch-action:manipulation;
  -webkit-tap-highlight-color:transparent;
}
button *,
.tab *,
.icon-button *{pointer-events:none}

button[data-role=primary],
button[data-role=important],
.numpad-commit,
.tab{
  position:relative;
}

button[data-role=primary]::after,
button[data-role=important]::after,
.numpad-commit::after,
.tab::after{
  content:"";
  position:absolute;
  top:-8px;
  bottom:-8px;
  left:-8px;
  right:-8px;
  background:transparent;
}

button,
.tab,
.icon-button,
.numpad-key,
.numpad-commit{
  user-select:none;
  -webkit-user-select:none;
}
input[type=text],
input[type=number],
select{
  min-height:44px;
  line-height:1.3;
  padding:0.45rem 0.6rem;
  font-size:1.05rem;
}
button,
.tab,
.numpad-key,
.numpad-commit{-webkit-tap-highlight-color:transparent}
main{display:block;width:100%}
.app-root{max-width:540px;margin:0 auto;padding:0 var(--sp-3) calc(1.5rem + env(safe-area-inset-bottom,0));display:flex;flex-direction:column;flex:1 1 auto;min-height:0;width:100%;position:relative}
html.app-booting .app-root::after{content:"Loader app…";position:fixed;top:10px;right:12px;padding:6px 10px;background:var(--panel);border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:0.9rem;box-shadow:0 6px 18px rgba(0,0,0,0.08);z-index:1200;opacity:0.95}
html.app-ready .app-root::after{display:none}
.tab-panels{flex:1 1 auto;min-height:0;overflow-y:auto;padding:clamp(0.5rem,2vw,1rem) 0 clamp(1rem,4vw,1.75rem);width:100%;margin:0 auto}
.tab-panel{min-width:0}
.tab-panel{color:var(--text)}
fieldset{border:1px solid var(--border);background:var(--panel);border-radius:var(--r-md);margin:0;padding:var(--pad)}
.card{border:1px solid var(--border);background:var(--panel);border-radius:var(--r-md);padding:0.85rem 0.95rem;display:flex;flex-direction:column;gap:var(--gap);content-visibility:auto;contain-intrinsic-size:320px;box-shadow:0 1px 0 rgba(255,255,255,0.02)}
.card-header{display:flex;flex-direction:column;gap:0.35rem}
.card-header h2{margin:0;font-size:1.15rem}
.card-header p{margin:0;color:var(--muted);font-size:0.9rem}
legend{color:var(--muted);padding:0 6px}
label{display:flex;flex-direction:column;gap:6px;font-size:0.95rem}
label span{color:var(--muted);font-size:0.85rem}
.form-field{display:flex;flex-direction:column;gap:6px;font-size:0.95rem}
.form-actions{margin-top:var(--gap);display:flex;justify-content:flex-end;gap:0.5rem;flex-wrap:wrap}
.form-actions button{min-width:160px;flex:0 1 200px}
.date-field .date-input-wrapper{display:flex;align-items:center;gap:8px}
.date-field .date-input-wrapper input[type=date]{flex:1}
.date-picker-trigger{display:inline-flex;align-items:center;justify-content:center;min-height:44px;min-width:44px;padding:0 12px;font-size:1.25rem;line-height:1;border:1px solid var(--border);background:var(--elev)}
.date-picker-trigger:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
input,select,textarea,button{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:var(--r-sm);min-height:44px;padding:10px;font-size:16px;max-width:100%;box-sizing:border-box;transition:border-color .12s ease,box-shadow .12s ease,background-color .12s ease}
input.numpad-readonly{caret-color:transparent}
textarea{resize:vertical}
button{cursor:pointer}
.sektion{flex-direction:column;gap:var(--gap)}
.row{display:flex;gap:8px;flex-wrap:wrap}
.btn-group{display:flex;gap:8px;flex-wrap:wrap}
.job-history{gap:var(--gap)}
.job-history__controls{display:flex;flex-direction:column;gap:var(--gap);align-items:stretch;position:sticky;top:0;z-index:2;background:var(--card);padding:0.25rem;border-radius:10px}
.job-history__controls label{flex:1 1 auto}
.job-history__controls button{flex:0 0 auto;min-width:140px}
.job-history__summary{overflow-x:auto}
.job-history__summary table{width:100%;border-collapse:collapse;min-width:520px}
.job-history__summary th,.job-history__summary td{text-align:left;padding:0.5rem;border-bottom:1px solid var(--border);white-space:nowrap}
.job-history__summary th{color:var(--muted);font-size:0.85rem;font-weight:600}
.job-history__summary td{font-variant-numeric:tabular-nums}
.job-history__list h3{margin:0 0 0.25rem;font-size:1rem}
.job-history__hint{margin:0 0 0.75rem;font-size:0.85rem;color:var(--muted)}
.job-history__list{display:flex;flex-direction:column;gap:0.5rem}
.tab-panel#panel-historik,.tab-panel#panel-historik h2,.tab-panel#panel-historik p,.tab-panel#panel-historik li,.tab-panel#panel-historik .history-table__head,.tab-panel#panel-historik .history-table__cell,.tab-panel#panel-historik .history-list__empty{color:var(--text)}
.tab-panel#panel-historik .history-table__head{color:var(--text)}
.export-panel{gap:0.75rem}
.export-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:0.5rem}
.export-actions button{padding:0.4rem 0.5rem;font-size:0.85rem;border-radius:0.75rem;background:var(--panel-soft);border:1px solid var(--border);min-height:44px;position:relative;overflow:hidden}
.export-actions button.is-busy{color:var(--muted)}
.export-actions button.is-busy::after{content:"";position:absolute;right:10px;top:50%;width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:999px;transform:translateY(-50%);animation:button-spin .9s linear infinite}
.export-comment{display:flex;flex-direction:column;gap:0.35rem;padding:0.75rem;border:1px dashed var(--border);border-radius:10px;background:var(--panel-soft)}
.export-comment legend{padding:0 4px;font-size:0.95rem}
#panel-lon .export-comment textarea{background:#ffffff;color:#000000;border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--pad);width:100%;font-size:1rem;line-height:1.4;resize:vertical}
.history-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:0.5rem;color:var(--muted);font-size:0.9rem;position:relative;min-height:3.5rem}
.history-list.is-loading::before{content:"Henter historik…";position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:0.9rem;color:var(--muted);background:linear-gradient(90deg,rgba(0,0,0,0.03),rgba(0,0,0,0.05),rgba(0,0,0,0.03));background-size:200% 100%;animation:history-shimmer 1.2s linear infinite}
.history-list.is-loading>*{opacity:0.45;pointer-events:none}
.history-list__empty{font-style:italic;color:var(--muted)}
.history-list__more button{width:100%}
.history-search{display:flex;flex-direction:column;gap:0.35rem}
.history-search__field{display:flex;flex-direction:column;gap:0.25rem}
.history-search__filters{display:flex;flex-wrap:wrap;gap:0.35rem;position:sticky;top:0.25rem;z-index:1;background:var(--card)}
.history-search__filter{min-height:36px;padding:0.35rem 0.5rem;border-radius:999px;border:1px solid var(--border);background:var(--panel-soft);color:var(--text);font-size:0.9rem}
.history-search__filter.is-active{background:var(--accent-soft);border-color:var(--accent);color:var(--text-strong)}
.history-item{border:1px solid var(--border);border-radius:12px;background:var(--panel-soft);contain:content;overflow:hidden;color:var(--text)}
.history-item__header{display:flex;align-items:center;justify-content:space-between;gap:0.75rem;padding:0.65rem 0.75rem;width:100%;border:0;background:none;text-align:left;cursor:pointer;min-height:44px}
.history-item__meta{display:flex;flex-direction:column;gap:0.2rem;flex:1;min-width:0}
.history-item__line{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.history-item__date{font-weight:600;color:var(--text)}
.history-item__meta-line{color:var(--muted);font-variant-numeric:tabular-nums}
.history-item__chevron{width:1rem;height:1rem;border-right:2px solid var(--muted);border-bottom:2px solid var(--muted);transform:rotate(-45deg);transition:transform 0.2s ease}
.history-item.is-open .history-item__chevron{transform:rotate(45deg)}
.history-item__body{padding:0.5rem 0.75rem 0.75rem;display:flex;flex-direction:column;gap:0.5rem;border-top:1px solid var(--border)}
.history-item__info,.history-item__wages,.history-item__workers{display:flex;flex-direction:column;gap:0.3rem}
.history-item__detail{display:flex;justify-content:space-between;gap:0.5rem;font-size:0.95rem}
.history-item__detail-label{color:var(--muted)}
.history-item__section-title{font-weight:600;font-size:0.95rem;color:var(--text)}
.history-item__worker-row{display:flex;justify-content:space-between;gap:0.5rem;font-size:0.95rem}
.history-item__worker-rate{font-weight:600}
.history-item__note{margin:0;font-size:0.9rem;color:var(--muted)}
.history-item__actions{display:flex;gap:0.5rem;flex-wrap:wrap}
.history-item__actions button{flex:1 1 auto;min-width:120px}
.tab-panel#panel-hjaelp,.tab-panel#panel-hjaelp h3,.tab-panel#panel-hjaelp p,.tab-panel#panel-hjaelp li,.tab-panel#panel-hjaelp legend,.tab-panel#panel-hjaelp strong,.tab-panel#panel-hjaelp ol,.tab-panel#panel-hjaelp ul{color:var(--text)}
.tab-panel#panel-hjaelp a{color:var(--accent)}
@media (min-width:641px){
  .history-item__header{padding:0.75rem 1rem}
  .history-item__body{padding:0.75rem 1rem 1rem}
}
.table-wrapper{width:100%;overflow-x:auto}
.table-wrapper table{width:100%;border-collapse:collapse;font-size:0.85rem}
.table-wrapper th,.table-wrapper td{padding:0.25rem 0.35rem;text-align:left;white-space:nowrap}
.table-wrapper th{font-weight:600}
.grid-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--gap)}
.grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:var(--gap)}
.form-grid{padding:var(--pad);background:var(--panel);border-radius:12px}
.col-span-3{grid-column:1/-1}
.materials{
  --name-col: minmax(0, 1.8fr);
  --qty-col: clamp(52px, 14vw, 100px);
  --price-col: clamp(60px, 16vw, 110px);
  --total-col: clamp(64px, 20vw, 128px);
  --materials-grid: var(--name-col) var(--qty-col) var(--price-col) var(--total-col);
  display: flex;
  flex-direction: column;
  width: 100%;
  color: var(--text);
}
.material-row,
.csm-row {
  display: grid;
  grid-template-columns: var(--materials-grid-desktop);
  column-gap: 10px;
  row-gap: 6px;
  align-items: center;
  padding: 10px 12px;
  min-height: 40px;
  border-radius: var(--radius-md);
  border:1px solid var(--border);
  background: var(--panel);
}

.material-row + .material-row,
.csm-row + .csm-row { margin-top: 8px; }

.material-options,.material-options span,.material-options strong{color:var(--text)}

.material-row.manual,
.csm-row.manual { background: var(--elev); }

.csm-row input,
.material-row input {
  height: 40px;
  padding: 0 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  background: var(--panel-soft);
  color: var(--text);
  outline: none;
  position: static;
  z-index: auto;
  font-size: 0.95rem;
}

.csm-row input[readonly],
.material-row input[readonly] {
  background: var(--panel-muted);
  color: var(--muted);
  cursor: default;
}

.csm-row input:focus,
.material-row input:focus { border-color: var(--accent); background: var(--elev); }

.csm-name { min-width: 140px; text-align: left; }
.manual .csm-name { font-weight: 600; }
.material-name{min-width:140px;text-align:left}
.material-total{text-align:right;white-space:nowrap;color:var(--text)}

.csm-qty,
.csm-price,
.mat-qty,
.mat-price {
  text-align: right;
}

.csm-sum,
.mat-sum {
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding: 0 12px;
  background: var(--panel-soft);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  color: var(--text);
  font-size: 0.95rem;
}

.material-row .mat-qty,
.material-row .mat-price,
.material-row .mat-sum,
.material-row .mat-name,
.csm-row .csm-qty,
.csm-row .csm-price,
.csm-row .csm-sum,
.csm-row .csm-name{color:var(--text)}

@media (max-width:400px){
  .material-row,
  .csm-row {
    grid-template-columns:var(--materials-grid-mobile);
    column-gap:6px;
  }

  .material-row .mat-name,
  .csm-row .mat-name,
  .csm-name{
    font-size:0.9rem;
    line-height:1.25;
    word-break:break-word;
  }
}

.csm-row--custom { all: unset; }
.csm-row--custom * { all: unset; }

.empty-state{margin:0;padding:16px;border:1px dashed var(--border);border-radius:12px;text-align:center;color:var(--muted);background:rgba(255,255,255,0.03)}

.overview{background:var(--elev);border:1px solid var(--border);border-radius:12px;padding:var(--pad)}
.totals{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--gap)}
.totals div{display:flex;flex-direction:column;gap:4px;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:12px}
.totals span{color:var(--muted);font-size:0.85rem}
.totals strong{font-size:1.25rem;color:var(--text)}
.hint{font-size:0.9rem;color:var(--muted);margin:0;min-height:1.2em}
.hint.error{color:#ff9b9b}
.hint.success{color:#8adbae}
.invalid{border-color:#d66;background:rgba(214,102,102,0.15)}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.overview-inline{background:transparent;border:none;padding:0}
.overview-inline .totals div{background:var(--elev)}
.worker-row{display:flex;flex-direction:column;gap:12px}
.extra-work-grid{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.worker-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--gap)}
.worker-grid label{display:flex;flex-direction:column;gap:6px}
.worker-grid span{color:var(--muted);font-size:0.85rem}
.worker-output{min-height:24px;font-size:0.95rem;color:#22c55e;font-weight:600}
.lon-result fieldset{color:var(--text)}
.lon-result legend{color:var(--text)}
.lon-result #lonResult{color:var(--text)}
.lon-result #lonResult h3{color:var(--text);margin:0.5rem 0 0.25rem}
.lon-result #lonResult>div,.lon-result #lonResult strong,.lon-result #lonResult span{color:var(--text)}
.lon-result #lonResult .worker-payline{color:#22c55e;font-weight:700;background:rgba(34,197,94,0.12);border-radius:10px;padding:8px 10px;margin-bottom:6px}
.system-selector{display:flex;flex-direction:column;gap:10px}
.system-selector-options{display:flex;flex-wrap:wrap;gap:10px}
.system-option{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:rgba(255,255,255,0.04);min-height:44px;transition:border-color .2s ease,background .2s ease}
.system-option input{width:18px;height:18px}
.system-option:hover{border-color:var(--accent);background:rgba(142,160,181,0.12)}
.system-warning{margin-top:6px}
.status-message{margin:6px 0 0;font-size:0.85rem}
.status-message.success{color:#8adbae}
.status-message.error{color:#ff9b9b}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:24px;z-index:999}
.modal.open{display:flex}
.modal[hidden]{display:none!important}
.modal-content{position:relative;background:var(--panel);border-radius:16px;border:1px solid var(--border);padding:24px;max-width:min(640px,90vw);width:100%;max-height:90vh;overflow:auto;box-shadow:0 20px 50px rgba(0,0,0,0.4);outline:none}
.modal-content h2{margin-top:0}
.modal-content ol{padding-left:22px;line-height:1.6}
.modal-content p{line-height:1.6}
.modal-close{position:absolute;top:16px;right:16px;width:36px;height:36px;border-radius:50%;border:1px solid var(--border);background:#3a3c43;color:var(--text);font-size:1.5rem;line-height:1;display:flex;align-items:center;justify-content:center;cursor:pointer}
@media (max-width:600px){
  header .bar{flex-direction:column;align-items:flex-start}
  .topbar-nav{width:100%}
  .grid-3{grid-template-columns:1fr}
  .grid-2{grid-template-columns:1fr}
  .worker-grid{grid-template-columns:1fr}
  .totals{grid-template-columns:1fr}
  .btn-group{flex-direction:column}
  .system-selector-options{gap:8px}
  .system-option{flex:1 1 calc(50% - 8px);justify-content:flex-start}
  .tab-panels{padding:0.5rem 0.75rem 1rem}
}
@media (max-width:480px){
  body{font-size:15px;line-height:1.4}
  .tabs .tab{flex:1 1 auto;width:auto}
  .material-row label{font-size:0.9rem}
  .material-row .system-badge{margin-left:6px;font-size:0.65rem}
  .system-option{flex:1 1 100%}
  header .bar{gap:12px}
  .worker-output{font-size:0.9rem}
  .form-actions button{flex:1 1 100%;min-width:0}
}

@media (max-width:360px){
  body{font-size:14px;line-height:1.35}
  .tabs{padding-inline:0.25rem}
}

/* Meget små skærme (gamle Android, 320–360 bredde) */
@media (max-width:360px){
  .tab,
  button,
  .icon-button,
  .material-btn{
    min-height:52px;
    min-width:52px;
    padding:0.65rem 0.9rem;
    font-size:1rem;
  }

  .numpad-key,
  .numpad-commit,
  .numpad-operator{
    min-height:58px;
    font-size:1.35rem;
    padding:0.9rem;
  }
}

/* Mellemstore mobiler (361–480px) */
@media (min-width:361px) and (max-width:480px){
  .tab,
  button,
  .icon-button,
  .material-btn{
    min-height:48px;
    min-width:48px;
    padding:0.55rem 0.85rem;
    font-size:0.95rem;
  }

  .numpad-key,
  .numpad-commit,
  .numpad-operator{
    min-height:54px;
    font-size:1.3rem;
  }
}

/* Større mobiler (> 480px), stadig touch-venlig */
@media (min-width:481px){
  .tab,
  button,
  .icon-button,
  .material-btn{
    min-height:44px;
    min-width:44px;
    padding:0.45rem 0.8rem;
    font-size:0.9rem;
  }

  .numpad-key,
  .numpad-commit,
  .numpad-operator{
    min-height:50px;
    font-size:1.2rem;
  }
}

@media (max-width:420px){
  #app,
  .app-root{
    width:100%;
    max-width:100%;
    margin:0 auto;
    padding-inline:8px;
  }

  main{padding:12px 0;gap:10px;}

  fieldset,
  .form-grid,
  .overview,
  .review-panel,
  .card,
  .panel{
    padding:10px 12px;
  }

  header .bar{padding-inline:8px;}

  .material-row,
  .csm-row{column-gap:4px;padding-inline:10px;}
}

@media print{
  header,nav,.no-print,.csmate-numpad{display:none!important}
  body{background:#fff;color:#000}
  fieldset{border-color:#000;background:#fff}
  .materials{max-height:none}
  .totals strong{color:#000}
}

:root{
  --primary:var(--accent);
  --fg:var(--panel);
}

/* Række for toggle/oversigt */
.material-options{
  display:flex;
  align-items:center;
  margin-bottom:var(--gap);
  margin-left:28px; /* undgå overlap med fold-ikon */
}

.material-options .toggle-selected{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:0.9rem;
}

.material-options input{
  width:18px;
  height:18px;
}

/* Custom checkbox styling til mørkt tema */
.material-options input[type="checkbox"]{
  appearance:none;
  display:inline-grid;
  place-content:center;
  width:18px;
  height:18px;
  border:2px solid var(--accent);
  border-radius:4px;
  background:#2f3238;
  cursor:pointer;
  transition:box-shadow .12s ease,background .12s ease,border-color .12s ease;
}

.material-options input[type="checkbox"]:checked{
  background:var(--primary);
  border-color:var(--primary);
}

.material-options input[type="checkbox"]::after{
  content:"";
  width:10px;
  height:10px;
  transform:scale(0);
  transition:transform .1s ease;
  background:var(--fg);
  mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="10" viewBox="0 0 12 10"><path fill="%23000" d="M4.0 7.2L1.5 4.8 0.4 5.9 4.0 9.5 11.6 1.9 10.5 0.8z"/></svg>') no-repeat center/contain;
}

.material-options input[type="checkbox"]:checked::after{
  transform:scale(1);
}

/* ===== Materials list (scoped) ===== */
.materials-list,
.csm-materials-list{
  display:flex;
  flex-direction:column;
  width:100%;
  gap:8px;
}

.csm-materials-list{
  overflow-y:auto;
  overscroll-behavior:contain;
  padding-bottom:12px;
}

.materials-virtual-list{
  display:block !important;
  position:relative;
  overflow-y:auto;
  overscroll-behavior:contain;
  padding-bottom:12px;
  max-height:clamp(360px,70vh,720px);
  border-radius:12px;
}

.materials-virtual-pool{
  position:absolute;
  inset:0;
}

.materials-virtual-spacer{
  width:100%;
  height:1px;
  pointer-events:none;
  visibility:hidden;
}

.materials-virtual-list .material-row,
.materials-virtual-list .csm-row{
  width:100%;
}

.materials-list .mat-row,
.csm-materials-list .csm-row{
  border:none;
}

.materials-list input{
  min-height:40px;
  padding:0 12px;
  font-size:0.9rem;
}

.materials-list input:focus{outline:2px solid #3b82f6;outline-offset:0}
.material-search{position:sticky;top:0;z-index:5;background:var(--panel);padding:6px 0;margin-bottom:4px}
.material-search__row{display:flex;align-items:center;gap:8px;padding:6px 8px;border:1px solid var(--border);border-radius:12px;background:var(--panel-soft)}
.material-search__icon{color:var(--muted);font-size:0.95rem}
.material-search input{flex:1 1 auto;border:0;background:transparent;color:var(--text);height:32px;padding:0;font-size:0.95rem}
.material-search input:focus{outline:none}
.material-search__clear{border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:10px;padding:4px 8px;min-height:32px;min-width:32px}
.material-search__clear[hidden]{display:none}
.material-search__meta{margin-top:4px;font-size:0.78rem;color:var(--muted);padding:0 2px}
.material-search__suggestions{margin-top:6px;border:1px solid var(--border);border-radius:12px;background:var(--panel);box-shadow:0 8px 20px rgba(0,0,0,0.28);overflow:hidden}
.material-search__suggestions[hidden]{display:none}
.material-search__suggestion{padding:8px 10px;font-size:0.95rem;color:var(--text);cursor:pointer;display:block}
.material-search__suggestion:hover,.material-search__suggestion:focus{background:var(--panel-soft)}

@media (max-width:400px){
  .material-row .mat-name,
  .csm-row .mat-name,
  .csm-name{
    font-size:0.9rem;
    line-height:1.25;
    word-break:break-word;
  }

  .material-row,
  .csm-row{
    gap:6px;
  }

  .material-row input,
  .csm-row input{
    font-size:0.9rem;
    padding-inline:10px;
  }
}



.review-panel{display:flex;flex-direction:column;gap:8px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:var(--pad)}
.review-row{display:flex;align-items:center;justify-content:space-between;gap:12px;font-size:0.95rem}
.review-row span{color:var(--muted)}
.review-row b{font-variant-numeric:tabular-nums;font-weight:600}
.review-row--total{background:rgba(255,255,255,0.02);padding:10px 12px;border-radius:10px;font-weight:600}
.review-row--header{margin-top:4px;padding-top:8px;border-top:1px solid var(--border);font-size:0.85rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.04em}
.review-row--subtle span{color:var(--muted);font-size:0.85rem}
.review-metadata{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.review-controls{display:flex;flex-direction:column;gap:8px}

.approval-controls{display:flex;flex-direction:column;gap:8px}
.approval-controls__header{display:flex;align-items:center;gap:12px}
.approval-controls__role{color:var(--muted)}
.approval-controls__actions{display:flex;gap:8px;flex-wrap:wrap}
.approval-button{background:#34353b;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 14px;font-size:0.95rem;min-height:40px}
.approval-button:disabled{opacity:0.5;cursor:not-allowed}

.approval-badge{display:inline-flex;align-items:center;justify-content:center;padding:6px 12px;border-radius:999px;border:1px solid var(--border);font-size:0.85rem;font-weight:600;text-transform:capitalize}
.approval-badge[data-status="afventer"]{background:rgba(255,196,38,0.12);color:#ffd66c;border-color:rgba(255,196,38,0.4)}
.approval-badge[data-status="godkendt"]{background:rgba(93,201,133,0.18);color:#8adbae;border-color:rgba(93,201,133,0.4)}
.approval-badge[data-status="afvist"]{background:rgba(214,102,102,0.18);color:#ff9b9b;border-color:rgba(214,102,102,0.4)}

.numpad-commit,.numpad-key,.numpad-operator{transition:background-color .2s ease,transform .2s ease,box-shadow .2s ease}
.numpad-commit{padding:.85rem 1rem;font-size:1.15rem;font-weight:700;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;letter-spacing:.01em}
.numpad-commit__label{font-size:1.05rem}
.numpad-commit__icon{font-size:1.35rem}
.numpad-commit--ready{background:linear-gradient(135deg,var(--accent-strong),var(--accent));box-shadow:0 0 0 2px rgba(0,0,0,.1) inset}
.numpad-hint{margin:.35rem 0 .5rem;text-align:center;color:var(--text-muted,#e5e7eb);font-size:.95rem}
.numpad-target-active{outline:2px solid var(--accent);outline-offset:3px}
.numpad-committed{animation:numpad-commit-flash .35s ease}
@keyframes numpad-commit-flash{0%{box-shadow:0 0 0 0 rgba(34,197,94,.25)}50%{box-shadow:0 0 0 6px rgba(34,197,94,.25)}100%{box-shadow:0 0 0 0 rgba(34,197,94,.05)}}
@keyframes button-spin{from{transform:translateY(-50%) rotate(0deg)}to{transform:translateY(-50%) rotate(360deg)}}
@keyframes history-shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.history-table{overflow-x:auto;border:1px solid var(--border);border-radius:10px;background:var(--panel-soft);padding:0.25rem}
.history-table__head{display:grid;grid-template-columns:140px minmax(190px,1fr) 110px 110px;gap:4px;padding:6px 8px;font-size:0.9rem;font-weight:600;font-variant-numeric:tabular-nums;color:var(--muted);background:var(--panel-soft);position:sticky;top:0;z-index:1}
.history-table__cell{padding:0 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.history-table__cell--amount,.history-row__cell--amount{text-align:right;font-variant-numeric:tabular-nums}
.history-table__cell--actions{text-align:right}
.history-table__body{list-style:none;padding:0.25rem;display:flex;flex-direction:column;gap:0.35rem;margin:0}
.history-row__summary{display:grid;grid-template-columns:140px minmax(190px,1fr) 110px 110px;align-items:center;gap:4px;padding:6px 8px;border:1px solid var(--border);border-radius:10px;background:var(--panel-soft);min-height:20px}
.history-row__cell{font-size:0.95rem;min-width:0}
.history-row__cell--meta{font-weight:600;color:var(--text)}
.history-row__cell--actions button{width:100%;min-width:92px}
.history-item__body{margin-top:0.35rem;border:1px solid var(--border);border-radius:10px;padding:0.65rem 0.75rem;background:var(--panel)}
.history-item__actions{justify-content:flex-end}

/* Debug outlines for material rows (kept to visualize rendered layout) */
.material-row{outline:1px solid red !important}
.material-row>*{outline:1px dashed lime !important}
