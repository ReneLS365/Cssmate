# Netlify config (optimized, stable)
# Key fixes:
# - Lighthouse audits "/" to avoid occasional /index.html 404
# - SPA fallback redirect keeps client routing working
# - Build/publish points to the staged output ".netlify_publish"

[functions]
  [functions.emails]
    included_files = ["./emails/**"]

[build]
  command = "npm run build"
  publish = ".netlify_publish"

  [build.environment]
    NODE_VERSION = "22"

[[plugins]]
  package = "netlify-plugin-a11y"
  [plugins.inputs]
    checkPaths = []
    resultMode = "warn"

[[plugins]]
  package = "@netlify/plugin-lighthouse"
  [plugins.inputs]
    [[plugins.inputs.audits]]
      path = "/"

[[headers]]
  for = "/reset"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

[[headers]]
  for = "/reset.html"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

[[headers]]
  for = "/api/*"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

[[redirects]]
  from = "/admin"
  to = "/admin.html"
  status = 200

[[redirects]]
  from = "/reset"
  to = "/reset.html"
  status = 200

# SPA fallback
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[context.deploy-preview]
  command = "npm run build"
  publish = ".netlify_publish"

[context.branch-deploy]
  command = "npm run build"
  publish = ".netlify_publish"

[context.production.functions]
  [context.production.functions.emails]
    included_files = ["./emails/**"]

[context.main.functions]
  [context.main.functions.emails]
    included_files = ["./emails/**"]
